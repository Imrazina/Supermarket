<!DOCTYPE html>
<html lang="cs">
<head><meta charset="UTF-8"><title>Sender</title></head>
<body>
<textarea id="msg" placeholder="Zadejte zprávu..."></textarea>
<button id="send">Odeslat</button>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
<script>
    const token = localStorage.getItem("token");
    const me = localStorage.getItem("username");
    const receiver = "kiki";

    const originCandidate = (window.location.origin && window.location.origin !== 'null') ? window.location.origin : '';
    const guessedLocalApi = (!originCandidate || (window.location.hostname === 'localhost' && window.location.port !== '8082'))
        ? 'http://localhost:8082'
        : originCandidate;
    const apiBaseUrl = (document.body.dataset.apiBase?.trim() || window.API_BASE_URL || guessedLocalApi).replace(/\/$/, '');

    const socket = new SockJS(`${apiBaseUrl}/ws`);
    const client = Stomp.over(socket);

    const currentUsername = localStorage.getItem("username");
    if (!token || !currentUsername) {
        alert("Pro použití aplikace se prosím přihlaste.");
        window.location.href = '/login.html';
    }

    client.connect({ Authorization: "Bearer " + token }, () => {
        console.log("Sender WS connected");
    });

    document.getElementById("send").onclick = () => {
        const content = document.getElementById("msg").value;
        client.send("/app/chat", { Authorization: "Bearer " + token }, JSON.stringify({ content, receiver }));
        alert("Odesláno!");
    };
</script>
</body>
</html>
