<script>
    let currentText = '';

    // Automatické kopírování při přijetí textu
    function autoCopy(text) {
        currentText = text;
        document.getElementById('message').textContent = text;

        navigator.clipboard.writeText(text)
            .then(() => {
                document.getElementById('copyStatus').textContent = '✓ Automaticky zkopírováno!';
                setTimeout(() => window.close(), 1000); // Zavřít po 1 s
            })
            .catch(err => {
                document.getElementById('copyStatus').textContent = ' Automatické kopírování selhalo';
                console.error(err);
            });
    }

    // Zpracování zpráv od Service Workeru
    window.addEventListener('message', event => {
        if (event.data?.type === 'copy') {
            autoCopy(event.data.text);
        }
    });

    // Zpracování parametru v URL
    window.addEventListener('load', () => {
        const param = new URLSearchParams(location.search).get('text');
        if (param) {
            autoCopy(decodeURIComponent(param));
        }
    });

    // Ruční kopírování (pro jistotu)
    document.getElementById('copyBtn').addEventListener('click', async () => {
        try {
            await navigator.clipboard.writeText(currentText);
            document.getElementById('copyStatus').textContent = 'Zkopírováno ručně!';
        } catch (err) {
            document.getElementById('copyStatus').textContent = ' Chyba kopírování';
            console.error(err);
        }
    });
</script>
